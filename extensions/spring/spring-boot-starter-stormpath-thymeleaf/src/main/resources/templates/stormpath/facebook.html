<!--/*
~ Copyright 2015 Stormpath, Inc.
~
~ Licensed under the Apache License, Version 2.0 (the "License");
~ you may not use this file except in compliance with the License.
~ You may obtain a copy of the License at
~
~     http://www.apache.org/licenses/LICENSE-2.0
~
~ Unless required by applicable law or agreed to in writing, software
~ distributed under the License is distributed on an "AS IS" BASIS,
~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
~ See the License for the specific language governing permissions and
~ limitations under the License.
*/-->
<th:block xmlns:th="http://www.thymeleaf.org">
    <button class="btn btn-social btn-facebook" onclick="facebookLogin()"
            th:text="#{stormpath.web.facebook.button.value}">Facebook</button>
    <script type="text/javascript" th:inline="javascript">
        /*<![CDATA[*/
        function facebookLogin() {
            var FB = window.FB;
            var facebookScopes = /*[[${facebook['scopes']}]]*/ 'facebook, scopes, here';
            var scopes = '';
            if (facebookScopes.length) {
                scopes = facebookScopes.join(',');
            }
            FB.login(function (response) {
                if (response.status === 'connected') {
                    var queryStr = window.location.search.replace('?', '');
                    var href = /*[[${facebook['serverUri'] + facebook['uri'] + '?'}]]*/ 'http://localhost:8080/facebook?';
                    if (queryStr) {
                        href += queryStr + '&access_token=' + response.authResponse.accessToken;
                    } else {
                        href += 'access_token=' + response.authResponse.accessToken;
                    }
                    window.location.replace(href);
                }
            }, {scope: 'email' + (scopes ? ',' + scopes : '')});
        }
        window.fbAsyncInit = function () {
            FB.init({
                appId: /*[[${facebook['clientId']}]]*/ 'facebook_app_id',
                cookie: true,
                xfbml: true,
                version: 'v2.0'
            });
        };
        (function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) {
                return;
            }
            js = d.createElement(s);
            js.id = id;
            js.src = "//connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
        /*]]>*/
    </script>
</th:block>